function setSizes(){canvasWidth=Math.floor(1*canvasDiv.parentNode.offsetWidth),canvasHeight=Math.floor(canvasWidth/ratio)}function init(){Detector.webgl?console.log("hu"):(console.log("detected"),Detector.addGetWebGLMessage(),document.getElementById("webglContent").innerHTML=""),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(45,ratio,1,1e3),renderer=new THREE.WebGLRenderer({antialias:!0});var e,t=new THREE.AmbientLight(4210752),n=new THREE.PointLight(16777215);for(n.position.set(250,250,250),setSizes(),e=0;3>e;e+=1)geometry.push(new THREE.Geometry);renderer.setSize(canvasWidth,canvasHeight),canvasDiv.appendChild(renderer.domElement),camera.position.set(-55,0,35),camera.lookAt(scene.position),scene.add(camera),scene.add(t),scene.add(n),renderer.setClearColor(0,1),window.addEventListener("resize",onWindowResize,!1),document.getElementById("sigmaText").innerHTML=" = "+sigma,document.getElementById("rhoText").innerHTML=" = "+r,document.getElementById("betaText").innerHTML=" = "+Math.round(10*b)/10}function makeVertices(e){var t,n,o=e,a=e,i=e,s=.01,c=[];for(t=0;300>t;t+=1)o+=sigma*(a-o)*s,a+=(o*(r-i)-a)*s,i+=(o*a-b*i)*s;for(t=0;numPoints/5>t;t+=1){for(n=0;2>n;n+=1)o+=sigma*(a-o)*s,a+=(o*(r-i)-a)*s,i+=(o*a-b*i)*s;c.push(new THREE.Vector3(o,i-25,a))}return c}function updateCurves(){var e=makeVertices(-1),t=makeVertices(1),n=new THREE.SplineCurve3(e),o=n.getPoints(numPoints),a=new THREE.SplineCurve3(t),r=a.getPoints(numPoints);for(geometry[0].vertices=[],geometry[1].vertices=[],i=0;i<o.length;i++)geometry[0].vertices.push(o[i]),geometry[1].vertices.push(r[i]);geometry[0].verticesNeedUpdate=!0,geometry[1].verticesNeedUpdate=!0}function createCurves(){var e,t;material.push(new THREE.LineBasicMaterial({color:16750848,transparent:!0,blending:THREE.AdditiveBlending,opacity:.6,linewidth:2})),material.push(new THREE.LineBasicMaterial({color:16732160,transparent:!0,blending:THREE.AdditiveBlending,opacity:.6,linewidth:2})),updateCurves(),e=new THREE.Line(geometry[0],material[0]),t=new THREE.Line(geometry[1],material[1]),scene.add(e),scene.add(t)}function updateParticles(){var e,t,n,o,a,i=.002;if(showButterflies)for(a=0;particleCount>a;a+=1)o=geometry[2].vertices[a],e=o.x,t=o.z,n=o.y+25,e+=sigma*(t-e)*i,t+=(e*(r-n)-t)*i,n+=(e*t-b*n)*i,o.x=e,o.y=n-25,o.z=t;geometry[2].verticesNeedUpdate=!0}function makeRandomParticles(e){var t,n,o,a,i,r=[];for(i=0;particleCount>i;i+=1)t=Math.random()*e-e/2,n=Math.random()*e-e/2,o=Math.random()*e-e/2,a=new THREE.Vector3(t,n,o),r.push(a);return r}function createParticles(){var e,t=THREE.ImageUtils.loadTexture("textures/butterfly.png");t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.set(4,4),material.push(new THREE.PointCloudMaterial({color:39372,blending:THREE.AdditiveBlending,map:t,transparent:!0,size:2})),geometry[2].vertices=makeRandomParticles(100),e=new THREE.PointCloud(geometry[2],material[2]),scene.add(e)}function render(){renderer.render(scene,camera)}function makeControls(){controls=new THREE.OrbitControls(camera,canvasDiv,canvasDiv)}function animateScene(){updateParticles(),requestAnimationFrame(animateScene),render(),null!=controls&&"undefined"!=typeof controls&&controls.update()}function onWindowResize(){setSizes(),camera.aspect=ratio,camera.updateProjectionMatrix(),renderer.setSize(canvasWidth,canvasHeight)}function changeRho(e){document.getElementById("rhoText").innerHTML=" = "+e,r=e,updateCurves()}function changeSigma(e){document.getElementById("sigmaText").innerHTML=" = "+e,sigma=e,updateCurves()}function changeBeta(e){document.getElementById("betaText").innerHTML=" = "+e,b=e,updateCurves()}function randomizeParticles(){geometry[2].vertices=makeRandomParticles(100),geometry[2].verticesNeedUpdate=!0}function particlesFromPoint(){geometry[2].vertices=makeRandomParticles(1),geometry[2].verticesNeedUpdate=!0}function handleShowButterflies(){showButterflies=!showButterflies,material[2].visible=showButterflies,document.getElementById("showButterflies").innerHTML=showButterflies?"Hide butterflies":"Show butterflies"}function handleShowCurves(){showCurves=!showCurves,material[0].visible=showCurves,material[1].visible=showCurves,document.getElementById("showCurves").innerHTML=showCurves?"Hide curves":"Show curves"}var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,n,o;e=e||{},t=void 0!==e.parent?e.parent:document.body,n=void 0!==e.id?e.id:"oldie",o=Detector.getWebGLErrorMessage(),o.id=n,t.appendChild(o)}};"object"==typeof module&&(module.exports=Detector),THREE.OrbitControls=function(e,t,n){function o(){return 2*Math.PI/60/60*h.autoRotateSpeed}function a(){return Math.pow(.95,h.zoomSpeed)}function i(e){if(h.enabled!==!1){if(e.preventDefault(),0===e.button){if(h.noRotate===!0)return;k=O.ROTATE,E.set(e.clientX,e.clientY)}else if(1===e.button){if(h.noZoom===!0)return;k=O.DOLLY,y.set(e.clientX,e.clientY)}else if(2===e.button){if(h.noPan===!0)return;k=O.PAN,f.set(e.clientX,e.clientY)}h.domElement.addEventListener("mousemove",r,!1),h.domElement.addEventListener("mouseup",s,!1)}}function r(e){if(h.enabled!==!1){e.preventDefault();var t=h.domElement===document?h.domElement.body:h.domElement;if(k===O.ROTATE){if(h.noRotate===!0)return;g.set(e.clientX,e.clientY),v.subVectors(g,E),h.rotateLeft(2*Math.PI*v.x/t.clientWidth*h.rotateSpeed),h.rotateUp(2*Math.PI*v.y/t.clientHeight*h.rotateSpeed),E.copy(g)}else if(k===O.DOLLY){if(h.noZoom===!0)return;T.set(e.clientX,e.clientY),H.subVectors(T,y),H.y>0?h.dollyIn():h.dollyOut(),y.copy(T)}else if(k===O.PAN){if(h.noPan===!0)return;w.set(e.clientX,e.clientY),b.subVectors(w,f),h.pan(b),f.copy(w)}h.update()}}function s(){h.enabled!==!1&&(h.domElement.removeEventListener("mousemove",r,!1),h.domElement.removeEventListener("mouseup",s,!1),k=O.NONE)}function c(e){if(h.enabled!==!1&&h.noZoom!==!0){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?h.dollyOut():h.dollyIn()}}function d(e){if(h.enabled!==!1&&h.noKeys!==!0&&h.noPan!==!0){var t=!1;switch(e.keyCode){case h.keys.UP:h.pan(new THREE.Vector2(0,h.keyPanSpeed)),t=!0;break;case h.keys.BOTTOM:h.pan(new THREE.Vector2(0,-h.keyPanSpeed)),t=!0;break;case h.keys.LEFT:h.pan(new THREE.Vector2(h.keyPanSpeed,0)),t=!0;break;case h.keys.RIGHT:h.pan(new THREE.Vector2(-h.keyPanSpeed,0)),t=!0}t&&h.update()}}function l(e){if(h.enabled!==!1)switch(e.touches.length){case 1:if(h.noRotate===!0)return;k=O.TOUCH_ROTATE,E.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(h.noZoom===!0)return;k=O.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);y.set(0,o);break;case 3:if(h.noPan===!0)return;k=O.TOUCH_PAN,f.set(e.touches[0].pageX,e.touches[0].pageY);break;default:k=O.NONE}}function u(e){if(h.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=h.domElement===document?h.domElement.body:h.domElement;switch(e.touches.length){case 1:if(h.noRotate===!0)return;if(k!==O.TOUCH_ROTATE)return;g.set(e.touches[0].pageX,e.touches[0].pageY),v.subVectors(g,E),h.rotateLeft(2*Math.PI*v.x/t.clientWidth*h.rotateSpeed),h.rotateUp(2*Math.PI*v.y/t.clientHeight*h.rotateSpeed),E.copy(g);break;case 2:if(h.noZoom===!0)return;if(k!==O.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(n*n+o*o);T.set(0,a),H.subVectors(T,y),H.y>0?h.dollyOut():h.dollyIn(),y.copy(T);break;case 3:if(h.noPan===!0)return;if(k!==O.TOUCH_PAN)return;w.set(e.touches[0].pageX,e.touches[0].pageY),b.subVectors(w,f),h.pan(b),f.copy(w);break;default:k=O.NONE}}}function m(){h.enabled!==!1&&(k=O.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.localElement=void 0!==n?n:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var h=this,p=1e-6,E=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,f=new THREE.Vector2,w=new THREE.Vector2,b=new THREE.Vector2,y=new THREE.Vector2,T=new THREE.Vector2,H=new THREE.Vector2,R=0,L=0,M=1,P=new THREE.Vector3,C=new THREE.Vector3,O={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},k=O.NONE,x={type:"change"};this.rotateLeft=function(e){void 0===e&&(e=o()),L-=e},this.rotateUp=function(e){void 0===e&&(e=o()),R-=e},this.panLeft=function(e){var t=new THREE.Vector3,n=this.object.matrix.elements;t.set(n[0],n[1],n[2]),t.multiplyScalar(-e),P.add(t)},this.panUp=function(e){var t=new THREE.Vector3,n=this.object.matrix.elements;t.set(n[4],n[5],n[6]),t.multiplyScalar(e),P.add(t)},this.pan=function(e){var t=h.domElement===document?h.domElement.body:h.domElement;if(void 0!==h.object.fov){var n=h.object.position,o=n.clone().sub(h.target),a=o.length();a*=Math.tan(h.object.fov/2*Math.PI/180),h.panLeft(2*e.x*a/t.clientHeight),h.panUp(2*e.y*a/t.clientHeight)}else void 0!==h.object.top?(h.panLeft(e.x*(h.object.right-h.object.left)/t.clientWidth),h.panUp(e.y*(h.object.top-h.object.bottom)/t.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=a()),M/=e},this.dollyOut=function(e){void 0===e&&(e=a()),M*=e},this.update=function(){var e=this.object.position,t=e.clone().sub(this.target),n=Math.atan2(t.x,t.z),a=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(o()),n+=L,a+=R,a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a)),a=Math.max(p,Math.min(Math.PI-p,a));var i=t.length()*M;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(P),t.x=i*Math.sin(a)*Math.sin(n),t.y=i*Math.cos(a),t.z=i*Math.sin(a)*Math.cos(n),e.copy(this.target).add(t),this.object.lookAt(this.target),L=0,R=0,M=1,P.set(0,0,0),C.distanceTo(this.object.position)>0&&(this.dispatchEvent(x),C.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.localElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("keydown",d,!1),this.localElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",m,!1),this.domElement.addEventListener("touchmove",u,!1)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);var sigma=10,r=28,b=2.5,ratio=4/3,numPoints=1e4,particleCount=1e4,scene,camera,renderer,controls,geometry=[],material=[],canvasDiv=document.getElementById("LorenzCanvas"),canvasWidth,canvasHeight,showCurves=!0,showButterflies=!0;init(),createCurves(),createParticles(),makeControls(),animateScene();